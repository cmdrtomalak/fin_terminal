"use strict";(()=>{function b(o){return o>=1e9?(o/1e9).toFixed(2)+"B":o>=1e6?(o/1e6).toFixed(2)+"M":o>=1e3?(o/1e3).toFixed(2)+"K":o.toString()}function g(o){return o>=1e12?"$"+(o/1e12).toFixed(2)+"T":o>=1e9?"$"+(o/1e9).toFixed(2)+"B":"$"+(o/1e6).toFixed(2)+"M"}function y(o){let e=new Date(o),t=new Date().getTime()-e.getTime(),r=Math.floor(t/(1e3*60*60));return r<1?"Just now":r<24?`${r}h ago`:e.toLocaleDateString()}function f(o){if(o==null||isNaN(o))return"\u2014";let e=Math.abs(o),s=o<0?"-":"";return e>=1e9?s+"$"+(e/1e9).toFixed(1)+"B":e>=1e6?s+"$"+(e/1e6).toFixed(1)+"M":e>=1e3?s+"$"+(e/1e3).toFixed(1)+"K":s+"$"+e.toFixed(0)}function w(o,e="number"){if(o==null||isNaN(o))return"N/A";switch(e){case"percent":return(o*100).toFixed(2)+"%";case"currency":return g(o);case"ratio":return o.toFixed(2);default:return b(o)}}function v(o){return o==null?"":o>=0?"positive":"negative"}var _=class{constructor(){this.statementsData=null;this.currentTab="income";this.currentSymbol=null;this.chart=null;this.candleSeries=null;this.searchTimeout=null;this.selectedIndex=-1;this.searchResultsData=[];this.newsData=[];this.commandInput=document.getElementById("command-input"),this.searchResults=document.getElementById("search-results"),this.welcomeScreen=document.getElementById("welcome-screen"),this.securityView=document.getElementById("security-view"),this.tickerList=document.getElementById("ticker-list"),this.statusText=document.getElementById("status-text"),this.newsModal=document.getElementById("news-modal"),this.ratiosModal=document.getElementById("ratios-modal"),this.indexModal=document.getElementById("index-modal"),this.statementsModal=document.getElementById("statements-modal"),this.init()}init(){this.setupEventListeners(),this.setupModalListeners(),this.setupRatiosModal(),this.setupIndexModal(),this.setupStatementsModal(),this.updateTime(),this.loadQuickTickers(),setInterval(()=>this.updateTime(),1e3)}setupEventListeners(){this.commandInput.addEventListener("input",()=>this.handleSearch()),this.commandInput.addEventListener("keydown",e=>this.handleKeydown(e)),this.commandInput.addEventListener("focus",()=>{this.searchResultsData.length>0&&this.searchResults.classList.add("active")}),document.addEventListener("click",e=>{!this.commandInput.contains(e.target)&&!this.searchResults.contains(e.target)&&this.searchResults.classList.remove("active")}),document.querySelectorAll(".chart-btn").forEach(e=>{e.addEventListener("click",s=>{let t=s.target,r=parseInt(t.dataset.days||"90",10);document.querySelectorAll(".chart-btn").forEach(a=>a.classList.remove("active")),t.classList.add("active"),this.currentSymbol&&this.loadChartData(this.currentSymbol,r)})})}setupModalListeners(){let e=document.getElementById("modal-close"),s=this.newsModal.querySelector(".modal-overlay");e?.addEventListener("click",()=>this.closeModal()),s?.addEventListener("click",()=>this.closeModal()),document.addEventListener("keydown",t=>{t.key==="Escape"&&!this.newsModal.classList.contains("hidden")&&this.closeModal()})}openNewsModal(e){let s=document.getElementById("modal-title"),t=document.getElementById("modal-source"),r=document.getElementById("modal-timestamp"),a=document.getElementById("modal-sentiment"),u=document.getElementById("modal-body"),n=document.getElementById("modal-link");if(s&&(s.textContent=e.title),t&&(t.textContent=e.source),r&&(r.textContent=this.formatTime(e.timestamp)),a&&(a.textContent=e.sentiment,a.className=`modal-sentiment ${e.sentiment}`),u){let d=e.content||e.summary;u.innerHTML=d.split(`

`).map(m=>`<p>${m}</p>`).join("")}n&&(n.href=e.url),this.newsModal.classList.remove("hidden")}closeModal(){this.newsModal.classList.add("hidden")}setupRatiosModal(){let e=document.getElementById("ratios-btn"),s=document.getElementById("ratios-modal-close"),t=this.ratiosModal.querySelector(".modal-overlay");e?.addEventListener("click",()=>this.openRatiosModal()),s?.addEventListener("click",()=>this.closeRatiosModal()),t?.addEventListener("click",()=>this.closeRatiosModal()),document.addEventListener("keydown",r=>{r.key==="Escape"&&!this.ratiosModal.classList.contains("hidden")&&this.closeRatiosModal()})}async openRatiosModal(){if(!this.currentSymbol)return;let e=document.getElementById("ratios-loading"),s=document.getElementById("ratios-body"),t=document.getElementById("ratios-modal-title");t&&(t.textContent=`${this.currentSymbol} - Financial Ratios`),e&&(e.style.display="block"),s&&(s.innerHTML=""),this.ratiosModal.classList.remove("hidden");try{let r=await fetch(`/api/financials/${this.currentSymbol}`);if(!r.ok)throw new Error("Failed to fetch");let a=await r.json();this.renderRatios(a)}catch{s&&(s.innerHTML='<div class="ratios-loading">Failed to load financial data</div>')}finally{e&&(e.style.display="none")}}closeRatiosModal(){this.ratiosModal.classList.add("hidden")}renderRatios(e){let s=document.getElementById("ratios-body");if(!s)return;let t=(r,a="number")=>w(r,a);s.innerHTML=`
            <div class="ratios-section">
                <div class="ratios-section-title">VALUATION</div>
                <div class="ratio-row"><span class="ratio-label">P/E (TTM)</span><span class="ratio-value">${t(e.pe_ratio,"ratio")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Forward P/E</span><span class="ratio-value">${t(e.forward_pe,"ratio")}</span></div>
                <div class="ratio-row"><span class="ratio-label">PEG Ratio</span><span class="ratio-value">${t(e.peg_ratio,"ratio")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Price/Book</span><span class="ratio-value">${t(e.price_to_book,"ratio")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Price/Sales</span><span class="ratio-value">${t(e.price_to_sales,"ratio")}</span></div>
                <div class="ratio-row"><span class="ratio-label">EV/Revenue</span><span class="ratio-value">${t(e.ev_to_revenue,"ratio")}</span></div>
                <div class="ratio-row"><span class="ratio-label">EV/EBITDA</span><span class="ratio-value">${t(e.ev_to_ebitda,"ratio")}</span></div>
            </div>

            <div class="ratios-section">
                <div class="ratios-section-title">PROFITABILITY</div>
                <div class="ratio-row"><span class="ratio-label">Profit Margin</span><span class="ratio-value ${v(e.profit_margin)}">${t(e.profit_margin,"percent")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Operating Margin</span><span class="ratio-value ${v(e.operating_margin)}">${t(e.operating_margin,"percent")}</span></div>
                <div class="ratio-row"><span class="ratio-label">ROA</span><span class="ratio-value ${v(e.return_on_assets)}">${t(e.return_on_assets,"percent")}</span></div>
                <div class="ratio-row"><span class="ratio-label">ROE</span><span class="ratio-value ${v(e.return_on_equity)}">${t(e.return_on_equity,"percent")}</span></div>
                <div class="ratio-row"><span class="ratio-label">EPS (TTM)</span><span class="ratio-value">${t(e.eps,"ratio")}</span></div>
                <div class="ratio-row"><span class="ratio-label">EPS Forward</span><span class="ratio-value">${t(e.eps_forward,"ratio")}</span></div>
            </div>

            <div class="ratios-section">
                <div class="ratios-section-title">GROWTH</div>
                <div class="ratio-row"><span class="ratio-label">Revenue Growth (QoQ)</span><span class="ratio-value ${v(e.quarterly_revenue_growth)}">${t(e.quarterly_revenue_growth,"percent")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Earnings Growth (QoQ)</span><span class="ratio-value ${v(e.quarterly_earnings_growth)}">${t(e.quarterly_earnings_growth,"percent")}</span></div>
            </div>

            <div class="ratios-section">
                <div class="ratios-section-title">INCOME STATEMENT</div>
                <div class="ratio-row"><span class="ratio-label">Revenue</span><span class="ratio-value">${t(e.revenue,"currency")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Revenue/Share</span><span class="ratio-value">${t(e.revenue_per_share,"ratio")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Gross Profit</span><span class="ratio-value">${t(e.gross_profit,"currency")}</span></div>
                <div class="ratio-row"><span class="ratio-label">EBITDA</span><span class="ratio-value">${t(e.ebitda,"currency")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Net Income</span><span class="ratio-value">${t(e.net_income,"currency")}</span></div>
            </div>

            <div class="ratios-section">
                <div class="ratios-section-title">BALANCE SHEET</div>
                <div class="ratio-row"><span class="ratio-label">Total Cash</span><span class="ratio-value">${t(e.total_cash,"currency")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Total Debt</span><span class="ratio-value">${t(e.total_debt,"currency")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Debt/Equity</span><span class="ratio-value">${t(e.debt_to_equity,"ratio")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Current Ratio</span><span class="ratio-value">${t(e.current_ratio,"ratio")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Book Value</span><span class="ratio-value">${t(e.book_value,"ratio")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Enterprise Value</span><span class="ratio-value">${t(e.enterprise_value,"currency")}</span></div>
            </div>

            <div class="ratios-section">
                <div class="ratios-section-title">CASH FLOW</div>
                <div class="ratio-row"><span class="ratio-label">Operating Cash Flow</span><span class="ratio-value">${t(e.operating_cash_flow,"currency")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Free Cash Flow</span><span class="ratio-value">${t(e.free_cash_flow,"currency")}</span></div>
            </div>

            <div class="ratios-section">
                <div class="ratios-section-title">STOCK INFO</div>
                <div class="ratio-row"><span class="ratio-label">Beta</span><span class="ratio-value">${t(e.beta,"ratio")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Shares Outstanding</span><span class="ratio-value">${t(e.shares_outstanding,"number")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Float</span><span class="ratio-value">${t(e.float_shares,"number")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Insider Ownership</span><span class="ratio-value">${t(e.held_by_insiders,"percent")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Institutional Ownership</span><span class="ratio-value">${t(e.held_by_institutions,"percent")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Short Ratio</span><span class="ratio-value">${t(e.short_ratio,"ratio")}</span></div>
            </div>

            <div class="ratios-section">
                <div class="ratios-section-title">DIVIDENDS</div>
                <div class="ratio-row"><span class="ratio-label">Dividend Rate</span><span class="ratio-value">${t(e.dividend_rate,"ratio")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Dividend Yield</span><span class="ratio-value">${t(e.dividend_yield,"percent")}</span></div>
                <div class="ratio-row"><span class="ratio-label">Payout Ratio</span><span class="ratio-value">${t(e.payout_ratio,"percent")}</span></div>
            </div>
        `}setupIndexModal(){let e=document.querySelector('[data-fn="INDEX"]'),s=document.getElementById("index-modal-close"),t=this.indexModal.querySelector(".modal-overlay");e?.addEventListener("click",()=>this.openIndexModal()),s?.addEventListener("click",()=>this.closeIndexModal()),t?.addEventListener("click",()=>this.closeIndexModal()),document.addEventListener("keydown",r=>{r.key==="Escape"&&!this.indexModal.classList.contains("hidden")&&this.closeIndexModal()})}async openIndexModal(){let e=document.getElementById("index-loading"),s=document.getElementById("index-body");e&&(e.style.display="block"),s&&(s.innerHTML=""),this.indexModal.classList.remove("hidden");try{let t=await fetch("/api/indices");if(!t.ok)throw new Error("Failed to fetch");let r=await t.json();this.renderIndices(r)}catch{s&&(s.innerHTML='<div class="ratios-loading">Failed to load indices</div>')}finally{e&&(e.style.display="none")}}closeIndexModal(){this.indexModal.classList.add("hidden")}renderIndices(e){let s=document.getElementById("index-body");if(!s)return;let r=(n=>{let d=new Map,m=["US","UK","Germany","France","Europe","Netherlands","Spain","Italy","Switzerland","Japan","Hong Kong","China","Australia","South Korea","Taiwan","India","Singapore","Brazil","Mexico","Canada"];for(let l of m){let p=n.filter(h=>h.region===l);p.length>0&&d.set(l,p)}return d})(e),a="",u={US:"UNITED STATES",UK:"UNITED KINGDOM",Germany:"GERMANY",France:"FRANCE",Europe:"EUROPE",Netherlands:"NETHERLANDS",Spain:"SPAIN",Italy:"ITALY",Switzerland:"SWITZERLAND",Japan:"JAPAN","Hong Kong":"HONG KONG",China:"CHINA",Australia:"AUSTRALIA","South Korea":"SOUTH KOREA",Taiwan:"TAIWAN",India:"INDIA",Singapore:"SINGAPORE",Brazil:"BRAZIL",Mexico:"MEXICO",Canada:"CANADA"};r.forEach((n,d)=>{a+=`<div class="index-section">
                <div class="index-section-title">${u[d]||d}</div>`;for(let m of n){let l=m.change>=0?"positive":"negative",p=m.change>=0?"+":"";a+=`
                <div class="index-row">
                    <div class="index-info">
                        <span class="index-symbol">${m.symbol}</span>
                        <span class="index-name">${m.name}</span>
                    </div>
                    <div class="index-data">
                        <span class="index-price">${m.price.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        <span class="index-change ${l}">${p}${m.change.toFixed(2)}</span>
                        <span class="index-percent ${l}">${p}${m.change_percent.toFixed(2)}%</span>
                    </div>
                </div>`}a+="</div>"}),s.innerHTML=a}setupStatementsModal(){let e=document.getElementById("statements-btn"),s=document.getElementById("statements-modal-close"),t=this.statementsModal.querySelector(".modal-overlay");e?.addEventListener("click",()=>this.openStatementsModal()),s?.addEventListener("click",()=>this.closeStatementsModal()),t?.addEventListener("click",()=>this.closeStatementsModal()),this.statementsModal.querySelectorAll(".stmt-tab").forEach(r=>{r.addEventListener("click",a=>{let u=a.target,n=u.dataset.tab;this.currentTab=n,this.statementsModal.querySelectorAll(".stmt-tab").forEach(d=>d.classList.remove("active")),u.classList.add("active"),this.statementsData&&this.renderStatements(this.statementsData)})}),document.addEventListener("keydown",r=>{r.key==="Escape"&&!this.statementsModal.classList.contains("hidden")&&this.closeStatementsModal()})}async openStatementsModal(){if(!this.currentSymbol)return;let e=document.getElementById("statements-loading"),s=document.getElementById("statements-body"),t=document.getElementById("statements-modal-title");t&&(t.textContent=`${this.currentSymbol} - Financial Statements`),e&&(e.style.display="block"),s&&(s.innerHTML=""),this.statementsModal.classList.remove("hidden");try{let r=await fetch(`/api/statements/${this.currentSymbol}`);if(!r.ok)throw new Error("Failed to fetch");this.statementsData=await r.json(),this.renderStatements(this.statementsData)}catch{s&&(s.innerHTML='<div class="ratios-loading">Failed to load financial statements</div>')}finally{e&&(e.style.display="none")}}closeStatementsModal(){this.statementsModal.classList.add("hidden")}renderStatements(e){let s=document.getElementById("statements-body");if(!s)return;let t=n=>f(n),r=n=>n.some(d=>d!=null&&d!==0),a=(n,d,m=!1)=>r(d)?`<tr${m?' class="stmt-highlight"':""}><td>${n}</td>${d.map(p=>`<td class="${v(p)}">${t(p)}</td>`).join("")}</tr>`:"",u="";if(this.currentTab==="income"){let n=e.income_statements;if(n.length===0)u='<div class="ratios-loading">No income statement data available</div>';else{let d=n.map(l=>l.fiscal_year.split("-")[0]||l.fiscal_year),m=[a("Total Revenue",n.map(l=>l.total_revenue),!0),a("Cost of Revenue",n.map(l=>l.cost_of_revenue)),a("Gross Profit",n.map(l=>l.gross_profit),!0),a("R&D Expenses",n.map(l=>l.research_development)),a("SG&A Expenses",n.map(l=>l.selling_general_admin)),a("Total Operating Expenses",n.map(l=>l.total_operating_expenses)),a("Operating Income",n.map(l=>l.operating_income),!0),a("Interest Expense",n.map(l=>l.interest_expense)),a("Income Before Tax",n.map(l=>l.income_before_tax)),a("Income Tax Expense",n.map(l=>l.income_tax_expense)),a("Net Income",n.map(l=>l.net_income),!0),a("EBIT",n.map(l=>l.ebit)),a("EBITDA",n.map(l=>l.ebitda))].filter(l=>l).join("");u=`
                    <table class="statements-table">
                        <thead>
                            <tr>
                                <th class="stmt-label-col">Item</th>
                                ${d.map(l=>`<th class="stmt-value-col">${l}</th>`).join("")}
                            </tr>
                        </thead>
                        <tbody>${m}</tbody>
                    </table>
                `}}else if(this.currentTab==="balance"){let n=e.balance_sheets;if(n.length===0)u='<div class="ratios-loading">No balance sheet data available</div>';else{let d=n.map(i=>i.fiscal_year.split("-")[0]||i.fiscal_year),m=[a("Cash & Equivalents",n.map(i=>i.cash_and_equivalents)),a("Short-term Investments",n.map(i=>i.short_term_investments)),a("Accounts Receivable",n.map(i=>i.accounts_receivable)),a("Inventory",n.map(i=>i.inventory)),a("Total Current Assets",n.map(i=>i.total_current_assets),!0),a("Property, Plant & Equipment",n.map(i=>i.property_plant_equipment)),a("Goodwill",n.map(i=>i.goodwill)),a("Intangible Assets",n.map(i=>i.intangible_assets)),a("Total Assets",n.map(i=>i.total_assets),!0)].filter(i=>i).join(""),l=[a("Accounts Payable",n.map(i=>i.accounts_payable)),a("Short-term Debt",n.map(i=>i.short_term_debt)),a("Total Current Liabilities",n.map(i=>i.total_current_liabilities),!0),a("Long-term Debt",n.map(i=>i.long_term_debt)),a("Total Liabilities",n.map(i=>i.total_liabilities),!0)].filter(i=>i).join(""),p=[a("Common Stock",n.map(i=>i.common_stock)),a("Retained Earnings",n.map(i=>i.retained_earnings)),a("Total Stockholders Equity",n.map(i=>i.total_stockholders_equity),!0)].filter(i=>i).join(""),h="";m&&(h+=`<tr class="stmt-section-header"><td colspan="${d.length+1}">ASSETS</td></tr>${m}`),l&&(h+=`<tr class="stmt-section-header"><td colspan="${d.length+1}">LIABILITIES</td></tr>${l}`),p&&(h+=`<tr class="stmt-section-header"><td colspan="${d.length+1}">EQUITY</td></tr>${p}`),h?u=`
                        <table class="statements-table">
                            <thead>
                                <tr>
                                    <th class="stmt-label-col">Item</th>
                                    ${d.map(i=>`<th class="stmt-value-col">${i}</th>`).join("")}
                                </tr>
                            </thead>
                            <tbody>${h}</tbody>
                        </table>
                    `:u='<div class="ratios-loading">No balance sheet data available</div>'}}else if(this.currentTab==="cashflow"){let n=e.cash_flows;if(n.length===0)u='<div class="ratios-loading">No cash flow data available</div>';else{let d=n.map(c=>c.fiscal_year.split("-")[0]||c.fiscal_year),m=[a("Net Income",n.map(c=>c.net_income)),a("Depreciation",n.map(c=>c.depreciation)),a("Change in Working Capital",n.map(c=>c.change_in_working_capital)),a("Operating Cash Flow",n.map(c=>c.operating_cash_flow),!0)].filter(c=>c).join(""),l=[a("Capital Expenditures",n.map(c=>c.capital_expenditures)),a("Investments",n.map(c=>c.investments)),a("Investing Cash Flow",n.map(c=>c.investing_cash_flow),!0)].filter(c=>c).join(""),p=[a("Dividends Paid",n.map(c=>c.dividends_paid)),a("Stock Repurchases",n.map(c=>c.stock_repurchases)),a("Debt Repayment",n.map(c=>c.debt_repayment)),a("Financing Cash Flow",n.map(c=>c.financing_cash_flow),!0)].filter(c=>c).join(""),h=a("Free Cash Flow",n.map(c=>c.free_cash_flow),!0),i="";m&&(i+=`<tr class="stmt-section-header"><td colspan="${d.length+1}">OPERATING ACTIVITIES</td></tr>${m}`),l&&(i+=`<tr class="stmt-section-header"><td colspan="${d.length+1}">INVESTING ACTIVITIES</td></tr>${l}`),p&&(i+=`<tr class="stmt-section-header"><td colspan="${d.length+1}">FINANCING ACTIVITIES</td></tr>${p}`),h&&(i+=`<tr class="stmt-section-header"><td colspan="${d.length+1}">FREE CASH FLOW</td></tr>${h}`),i?u=`
                        <table class="statements-table">
                            <thead>
                                <tr>
                                    <th class="stmt-label-col">Item</th>
                                    ${d.map(c=>`<th class="stmt-value-col">${c}</th>`).join("")}
                                </tr>
                            </thead>
                            <tbody>${i}</tbody>
                        </table>
                    `:u='<div class="ratios-loading">No cash flow data available</div>'}}s.innerHTML=u}handleKeydown(e){let s=this.searchResults.querySelectorAll(".search-item");e.key==="ArrowDown"?(e.preventDefault(),this.selectedIndex=Math.min(this.selectedIndex+1,s.length-1),this.updateSelectedItem(s)):e.key==="ArrowUp"?(e.preventDefault(),this.selectedIndex=Math.max(this.selectedIndex-1,-1),this.updateSelectedItem(s)):e.key==="Enter"?(e.preventDefault(),this.selectedIndex>=0&&this.searchResultsData[this.selectedIndex]?this.selectCompany(this.searchResultsData[this.selectedIndex]):this.searchResultsData.length>0&&this.selectCompany(this.searchResultsData[0])):e.key==="Escape"&&(this.searchResults.classList.remove("active"),this.selectedIndex=-1)}updateSelectedItem(e){e.forEach((s,t)=>{s.classList.toggle("selected",t===this.selectedIndex)})}async handleSearch(){let e=this.commandInput.value.trim();if(this.searchTimeout&&clearTimeout(this.searchTimeout),e.length<1){this.searchResults.classList.remove("active"),this.searchResultsData=[];return}this.searchTimeout=window.setTimeout(async()=>{this.setStatus("SEARCHING...");try{let t=await(await fetch(`/api/search?q=${encodeURIComponent(e)}`)).json();this.searchResultsData=t,this.selectedIndex=-1,this.renderSearchResults(t),this.setStatus("READY")}catch{this.setStatus("ERROR")}},150)}renderSearchResults(e){if(e.length===0){this.searchResults.innerHTML='<div class="search-item">No results found</div>',this.searchResults.classList.add("active");return}this.searchResults.innerHTML=e.map((s,t)=>`
            <div class="search-item" data-index="${t}">
                <span class="symbol">${s.symbol}</span>
                <span class="name">${s.name}</span>
            </div>
        `).join(""),this.searchResults.querySelectorAll(".search-item").forEach(s=>{s.addEventListener("click",()=>{let t=parseInt(s.dataset.index||"0",10);this.selectCompany(e[t])})}),this.searchResults.classList.add("active")}selectCompany(e){this.currentSymbol=e.symbol,this.commandInput.value=e.symbol,this.searchResults.classList.remove("active"),this.loadSecurityView(e)}async loadSecurityView(e){this.setStatus("LOADING..."),this.welcomeScreen.classList.add("hidden"),this.securityView.classList.remove("hidden"),await Promise.all([this.loadQuote(e.symbol),this.loadChartData(e.symbol,30),this.loadNews(e.symbol)]),this.renderDescription(e),this.setStatus("READY")}async loadQuote(e){try{let t=await(await fetch(`/api/quote/${e}`)).json();this.renderQuote(t)}catch{console.error("Failed to load quote")}}renderQuote(e){let s=document.getElementById("quote-symbol"),t=document.getElementById("quote-name"),r=document.getElementById("quote-exchange"),a=document.getElementById("quote-price"),u=document.getElementById("quote-change"),n=document.getElementById("quote-details");if(s&&(s.textContent=e.symbol),t&&(t.textContent=e.name),r&&(r.textContent=`\u2022 ${e.symbol.includes(".")?"LSE":"NASDAQ"}`),a&&(a.textContent=e.price.toFixed(2)),u){let d=e.change>=0?"+":"";u.textContent=`${d}${e.change.toFixed(2)} (${d}${e.change_percent.toFixed(2)}%)`,u.className=`change ${e.change>=0?"positive":"negative"}`}n&&(n.innerHTML=`
                <div class="quote-row"><span class="label">Open</span><span class="value">${e.open.toFixed(2)}</span></div>
                <div class="quote-row"><span class="label">High</span><span class="value">${e.high.toFixed(2)}</span></div>
                <div class="quote-row"><span class="label">Low</span><span class="value">${e.low.toFixed(2)}</span></div>
                <div class="quote-row"><span class="label">Volume</span><span class="value">${this.formatNumber(e.volume)}</span></div>
                <div class="quote-row"><span class="label">Mkt Cap</span><span class="value">${this.formatMarketCap(e.market_cap)}</span></div>
                <div class="quote-row"><span class="label">P/E</span><span class="value">${e.pe_ratio?.toFixed(2)||"N/A"}</span></div>
                <div class="quote-row"><span class="label">EPS</span><span class="value">${e.eps?.toFixed(2)||"N/A"}</span></div>
                <div class="quote-row"><span class="label">Div Yield</span><span class="value">${e.dividend_yield?e.dividend_yield.toFixed(2)+"%":"N/A"}</span></div>
                <div class="quote-row"><span class="label">52W High</span><span class="value">${e.week_52_high.toFixed(2)}</span></div>
                <div class="quote-row"><span class="label">52W Low</span><span class="value">${e.week_52_low.toFixed(2)}</span></div>
                <div class="quote-row"><span class="label">Avg Vol</span><span class="value">${this.formatNumber(e.avg_volume)}</span></div>
            `)}async loadChartData(e,s){try{let r=await(await fetch(`/api/chart/${e}?days=${s}`)).json();this.renderChart(r)}catch{console.error("Failed to load chart data")}}renderChart(e){let s=document.getElementById("chart-container");if(!s)return;this.chart&&this.chart.remove(),this.chart=LightweightCharts.createChart(s,{width:s.clientWidth,height:s.clientHeight,layout:{background:{color:"#111111"},textColor:"#888888"},grid:{vertLines:{color:"#222222"},horzLines:{color:"#222222"}},crosshair:{mode:LightweightCharts.CrosshairMode.Normal},rightPriceScale:{borderColor:"#333333"},timeScale:{borderColor:"#333333",timeVisible:!0}}),this.candleSeries=this.chart.addCandlestickSeries({upColor:"#00ff00",downColor:"#ff3333",borderUpColor:"#00ff00",borderDownColor:"#ff3333",wickUpColor:"#00ff00",wickDownColor:"#ff3333"});let t=e.points.map(a=>({time:a.timestamp,open:a.open,high:a.high,low:a.low,close:a.close}));this.candleSeries.setData(t),this.chart.timeScale().fitContent(),new ResizeObserver(()=>{this.chart&&s&&this.chart.applyOptions({width:s.clientWidth,height:s.clientHeight})}).observe(s)}async loadNews(e){try{let t=await(await fetch(`/api/news/${e}`)).json();this.renderNews(t)}catch{console.error("Failed to load news")}}renderNews(e){let s=document.getElementById("news-feed");s&&(this.newsData=e.items,s.innerHTML=e.items.map((t,r)=>`
            <div class="news-item">
                <div class="headline" data-news-index="${r}">${t.title}</div>
                <div class="meta">
                    <span>${t.source}</span>
                    <span>${this.formatTime(t.timestamp)}</span>
                    <span class="sentiment ${t.sentiment}">${t.sentiment.toUpperCase()}</span>
                </div>
            </div>
        `).join(""),s.querySelectorAll(".headline").forEach(t=>{t.addEventListener("click",()=>{let r=parseInt(t.dataset.newsIndex||"0",10);this.newsData[r]&&this.openNewsModal(this.newsData[r])})}))}renderDescription(e){let s=document.getElementById("company-description");s&&(s.innerHTML=`
                <p><strong>Sector:</strong> ${e.sector}</p>
                <p><strong>Industry:</strong> ${e.industry}</p>
                <p>${e.description}</p>
            `)}loadQuickTickers(){let e=["AAPL","MSFT","GOOGL","AMZN","NVDA","META","TSLA"];this.tickerList.innerHTML=e.map(s=>`<div class="ticker-item" data-symbol="${s}">${s}</div>`).join(""),this.tickerList.querySelectorAll(".ticker-item").forEach(s=>{s.addEventListener("click",async()=>{let t=s.dataset.symbol;if(t){this.commandInput.value=t;let a=await(await fetch(`/api/search?q=${t}`)).json();a.length>0&&this.selectCompany(a[0])}})})}updateTime(){let e=document.getElementById("current-time");if(e){let s=new Date;e.textContent=s.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}}setStatus(e){this.statusText.textContent=e}formatNumber(e){return b(e)}formatMarketCap(e){return g(e)}formatTime(e){return y(e)}};document.addEventListener("DOMContentLoaded",()=>{new _});})();
